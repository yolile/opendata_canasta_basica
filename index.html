<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Historico Canasta Basica Familiar</title>
</head>
<body>

	<div id="mainMap"
		style="height: 500px; border: 1px solid #ccc; padding: 10px;"></div>

		<form>
		 Producto: <select id="producto" name="producto" onchange="cambiarProducto();">
			<option value="Naranja">Banana Carape</option>
			<option value="Bananacarape">Naranja</option>
			<option value="Kokito">Kokito</option>
			<option value="PanFelipito">Pan Felipito</option>
			<option value="Harina">Harina</option>
			<option value="Galleta">Galleta</option>
			<option value="Mandioca">Mandioca</option>
			<option value="Arroz">Arroz</option>
			<option value="Fideo">Fideo</option>
			<option value="Azucar">Azucar</option>
			<option value="Poroto">Vacio</option>
			<option value="Yerba">Yerba</option>
			<option value="QuesoParaguay">Queso Paraguay</option>
			<option value="TapaCuadril">Tapa Cuadril</option>
			<option value="TapadeAsado">Tapa de Asado</option>
			<option value="Lomo">Lomito</option>
			<option value="Costilla">Lomito</option>
			<option value="Vacio">Vacio</option>
			<option value="Puchero">Vacio</option>

		</select>
<select id="indice" onchange="cambiarIndice();" name="indice">
		<option value="ipc">Indice de Precio del Consumidor</option>
		<option value="dolar">Dolar</option>

		</select>

	</form>
	<div id="mainMapRanking"
		style="height: 500px; border: 1px solid #ccc; padding: 10px;"></div>
	<script src="resources/js/echarts/build/dist/echarts-all.js"></script>
	<script src="resources/js/pearson-correlation.js"></script>
	<script src="final.js"></script>
	<script src="final.js"></script>
	<script type="text/javascript">
	var prods= new Array('Kokito','PanFelipito','Naranja','QuesoParaguay','TapadeAsado','Costilla',
				'Lomo','Harina','Galleta','Mandioca','Arroz','Fideo','Azucar','Bananacarape','Yerba',
				'Vacio','Poroto','Puchero','TapaCuadril')


function getCorrelationArray(year, indice) {
	var aRet = new Array();
	for (var i = 0; i < 19; i++){
		console.log(year + prods[i]);
		aRet.push(pearsonCorrelation(new Array(dataMap.data[prods[i]][year],dataMap.dataIndices[indice][year]),0,1))
	}
	console.log(aRet);
	return aRet;
}

	function cambiarProducto(){
		var x = document.getElementById("producto").value;
		producto = x;
		dataMap.dataGDP_Estate = dataMix([ dataMap.dataFormat[indice], dataMap.dataFormat[producto] ]);

		refresh();
	};
	function cambiarIndice(){
		var x = document.getElementById("indice").value;
		indice = x;
		dataMap.dataGDP_Estate = dataMix([ dataMap.dataFormat[indice], dataMap.dataFormat[producto] ]);

		refresh();
	};
	function refresh(){

			myChart2.dispose();
	    myChart2 = echarts.init(document.getElementById('mainMap'));

	    myChart2.setOption(getOption(indice, producto));

	}
		function getMax(key) {
			var max = 0;
			for (var year = 2008; year <= 2014; year++) {
					var actual = Math.max.apply(null,dataMap.data[key][year]);
					if(actual>max){
						max = actual;
					}
			}
			return max;
		}
		function getMin(key) {
			console.log(key);
			var min = 999999;
			for (var year = 2008; year <= 2014; year++) {
					var actual = Math.min.apply(null,dataMap.data[key][year]);
					if(actual<min){
						min = actual;
					}
			}
			return min;
		}
		function getMaxIndices(key) {
			var max = 0;
			for (var year = 2008; year <= 2014; year++) {
					var actual = Math.max.apply(null,dataMap.dataIndices[key][year]);
					if(actual>max){
						max = actual;
					}
			}
			return max;
		}
		function getMinIndices(key) {
			var min = 999999;
			for (var year = 2008; year <= 2014; year++) {
					var actual = Math.min.apply(null,dataMap.dataIndices[key][year]);
					if(actual<min){
						min = actual;
					}
			}
			return min;
		}

		var myChart2 = echarts.init(document.getElementById('mainMap'));
		var myChartRanking = echarts.init(document.getElementById('mainMapRanking'));
		function getOption(indice, producto) {
		option = {

			timeline : {
				data : [ '2008-01-01', '2009-01-01','2010-01-01','2011-01-01','2012-01-01'
				         ,'2013-01-01','2014-01-01'],
				label : {
					formatter : function(s) {
						return s.slice(0, 4);
					}
				},
				autoPlay : true,
				playInterval : 1000
			},
			options : [ {
				title : {
					'text' : '2008 Precio vs ' + indice,
					'subtext' : 'Producto:' + producto
				},
				tooltip : {
					trigger : 'axis',
					showDelay : 0,
					axisPointer : {
						show : true,
						type : 'cross',
						lineStyle : {
							type : 'dashed',
							width : 1
						}
					}
				},
				toolbox : {
					'show' : true,
					orient : 'vertical',
					x : 'right',
					y : 'center',
					'feature' : {
						'mark' : {
							'show' : true
						},
						'dataView' : {
							'show' : true,
							'readOnly' : false
						},
						'restore' : {
							'show' : true
						},
						'saveAsImage' : {
							'show' : true
						}
					}
				},
				grid : {
					'y' : 80,
					'y2' : 100
				},
				xAxis : [ {
					'type' : 'value',
					'name' : indice,
					'max' : getMaxIndices(indice),
					'min' : getMinIndices(indice)


				} ],
				yAxis : [ {
					'type' : 'value',
					'name' : 'Precio',
					'max' : getMax(producto),
					'min' : getMin(producto)
				} ],
				series : [ {
					'name' : 'Precio',
					'type' : 'scatter',
					markLine : {
						data : [ {
							type : 'average',
							name : 'Promedio',
							itemStyle : {
								normal : {
									borderColor : 'red'
								}
							}
						}, {
							type : 'average',
							name : 'Promedio',
							valueIndex : 0,
							itemStyle : {
								normal : {
									borderColor : 'red'
								}
							}
						} ]
					},
					symbolSize : 5,
					itemStyle : {
						normal : {
							label : {
								show : true,
								formatter : '{b}'
							}
						}
					},
					'data' : dataMap.dataGDP_Estate['2008']

				}
				]
				}, {
					title : {
						'text' : '2009 Precio vs ' + indice,
					},
					series : [ {
						'data' : dataMap.dataGDP_Estate['2009']
					}
					]
				}, {
					title : {
						'text' : '2010 Precio vs ' + indice,
					},
					series : [ {
						'data' : dataMap.dataGDP_Estate['2010']
					}
					]
				}, {
					title : {
						'text' : '2011 Precio vs ' + indice,
					},
					series : [ {
						'data' : dataMap.dataGDP_Estate['2011']
					}
					]
				}, {
					title : {
						'text' : '2012 Precio vs ' + indice,
					},
					series : [ {
						'data' : dataMap.dataGDP_Estate['2012']
					}
					]
				}, {
					title : {
						'text' : '2013 Precio vs ' + indice,
					},
					series : [ {
						'data' : dataMap.dataGDP_Estate['2013']
					}
					]
				}, {
					title : {
						'text' : '2014 Precio vs ' + indice,
					},
					series : [ {
						'data' : dataMap.dataGDP_Estate['2014']
					}
					]
				}
			]

		}
	return option;};
		myChart2.setOption(getOption(indice, producto));


//GRAFICO DE PRODUCTOS MAS CORRELACIONADOS



optionRanking = {
    timeline:{

					data : [ '2008-01-01', '2009-01-01','2010-01-01','2011-01-01','2012-01-01'
									 ,'2013-01-01','2014-01-01'],
        label : {
            formatter : function(s) {
                return s.slice(0, 4);
            }
        },
        autoPlay : true,
        playInterval : 1000
    },
    options:[
        {
            title : {
                'text':'2008',

            },
            tooltip : {'trigger':'axis'},
            legend : {
                x:'right',
                'data':['GDP','金融','房地产','第一产业','第二产业','第三产业'],

            },
            toolbox : {
                'show':true,
                orient : 'vertical',
                x: 'right',
                y: 'center',
                'feature':{
                    'mark':{'show':true},
                    'dataView':{'show':true,'readOnly':false},
                    'magicType':{'show':true,'type':['line','bar','stack','tiled']},
                    'restore':{'show':true},
                    'saveAsImage':{'show':true}
                }
            },
            calculable : true,
            grid : {'y':80,'y2':100},
            xAxis : [{
                'type':'category',
                'axisLabel':{'interval':0},
                'data':prods
            }],
            yAxis : [
                {
                    'type':'value',
                    'name':'Correlacion',
                    'max':1,
										'min':-1
                },
                {
                    'type':'value',
                    'name':'其他（亿元）'
                }
            ],
            series : [
                {
                    'name':'GDP',
                    'type':'bar',
                    'markLine':{
                        symbol : ['arrow','none'],
                        symbolSize : [4, 2],
                        itemStyle : {
                            normal: {
                                lineStyle: {color:'orange'},
                                barBorderColor:'orange',
                                label:{
                                    position:'left',
                                    formatter:function(params){
                                        return Math.round(params.value);
                                    },
                                    textStyle:{color:'orange'}
                                }
                            }
                        },
                        'data':[{'type':'average','name':'平均值'}]
                    },
                    'data': getCorrelationArray('2008','dolar')
                }
            ]
        },
        {
            title : {'text':'2003全国宏观经济指标'},
            series : [
                {'data': getCorrelationArray('2009','dolar')}
            ]
        },
        {
            title : {'text':'2004全国宏观经济指标'},
            series : [
							{'data': getCorrelationArray('2010','dolar')}
            ]
        },
        {
            title : {'text':'2005全国宏观经济指标'},
            series : [
							{'data': getCorrelationArray('2011','dolar')}]
        },
        {
            title : {'text':'2006全国宏观经济指标'},
            series : [
							{'data': getCorrelationArray('2012','dolar')}
						]
        },
        {
            title : {'text':'2007全国宏观经济指标'},
            series : [
							{'data': getCorrelationArray('2013','dolar')}
            ]
        },
        {
            title : {'text':'2008全国宏观经济指标'},
            series : [
							{'data': getCorrelationArray('2014','dolar')}
            ]
        }
    ]
};
myChartRanking.setOption(optionRanking);


	</script>
</body>
</html>
